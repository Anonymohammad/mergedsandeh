<script type="text/babel">
const normalizeNumberInput = (value) => value.replace(/[٠-٩]/g, d => '٠١٢٣٤٥٦٧٨٩'.indexOf(d));

function PettyCashEntryForm({ entry, onChange, onSubmit, onCancel, isEditing, categories, t }) {
    return React.createElement('div', { className: 'space-y-2 petty-cash-form' },
        React.createElement('label', { className: 'block text-sm font-medium' }, t('category')),
        React.createElement('select', {
            value: entry.category,
            onChange: e => onChange({ ...entry, category: e.target.value }),
            className: 'w-full p-2 border rounded'
        }, [
            React.createElement('option', { key: '', value: '' }, t('selectCategory')),
            ...categories.map(cat => React.createElement('option', { key: cat.key, value: cat.key }, t(cat.labelKey)))
        ]),
        React.createElement('label', { className: 'block text-sm font-medium' }, t('description')),
        React.createElement('input', {
            type: 'text',
            value: entry.description,
            onChange: e => onChange({ ...entry, description: e.target.value }),
            className: 'w-full p-2 border rounded',
            required: true
        }),
        React.createElement('label', { className: 'block text-sm font-medium' }, t('amount')),
        React.createElement('input', {
            type: 'number',
            step: '0.01',
            min: '0.01',
            value: entry.amount,
            onChange: e => onChange({ ...entry, amount: normalizeNumberInput(e.target.value) }),
            className: 'w-full p-2 border rounded',
            required: true
        }),
        React.createElement('label', { className: 'block text-sm font-medium' }, t('paidBy')),
        React.createElement('input', {
            type: 'text',
            value: entry.paid_by,
            onChange: e => onChange({ ...entry, paid_by: e.target.value }),
            className: 'w-full p-2 border rounded',
            required: true
        }),
        React.createElement('div', { className: 'flex space-x-2 modal-actions' },
            React.createElement('button', {
                type: 'button',
                onClick: onSubmit,
                className: 'bg-olive-600 text-white px-4 py-2 rounded'
            }, isEditing ? t('updateEntry') : t('addEntry')),
            isEditing && React.createElement('button', {
                type: 'button',
                onClick: onCancel,
                className: 'bg-gray-500 text-white px-4 py-2 rounded'
            }, t('cancelEdit'))
        )
    );
}

function PettyCashEntriesList({ entries, onEdit, onDelete, categories, t }) {
    const total = entries.reduce((sum, e) => sum + (parseFloat(e.amount) || 0), 0);

    const getCategoryLabel = (key) => {
        const cat = categories.find(c => c.key === key);
        return cat ? t(cat.labelKey) : key;
    };

    if (entries.length === 0) {
        return React.createElement('p', { className: 'mt-4 text-sm text-gray-500' }, t('noPettyCashEntries'));
    }

    return React.createElement('div', { className: 'mt-4 petty-cash-table' },
        React.createElement('table', { className: 'min-w-full text-sm border' },
            React.createElement('thead', null,
                React.createElement('tr', { className: 'bg-gray-100' },
                    [t('category'), t('description'), t('amount'), t('paidBy'), t('actions')].map((h, i) =>
                        React.createElement('th', { key: i, className: 'px-2 py-1 border text-start' }, h)
                    )
                )
            ),
            React.createElement('tbody', null,
                entries.map((e, idx) =>
                    React.createElement('tr', { key: idx },
                        React.createElement('td', { className: 'border px-2 py-1' }, getCategoryLabel(e.category)),
                        React.createElement('td', { className: 'border px-2 py-1' }, e.description),
                        React.createElement('td', { className: 'border px-2 py-1' }, parseFloat(e.amount).toFixed(2)),
                        React.createElement('td', { className: 'border px-2 py-1' }, e.paid_by),
                        React.createElement('td', { className: 'border px-2 py-1 space-x-2' },
                            React.createElement('button', { type: 'button', onClick: () => onEdit(idx), className: 'text-blue-600' }, t('editEntry')),
                            React.createElement('button', { type: 'button', onClick: () => onDelete(idx), className: 'text-red-600' }, t('deleteEntry'))
                        )
                    )
                ),
                React.createElement('tr', { className: 'font-medium bg-gray-50' },
                    React.createElement('td', { className: 'border px-2 py-1', colSpan: 2 }, t('totalAmount')),
                    React.createElement('td', { className: 'border px-2 py-1' }, total.toFixed(2)),
                    React.createElement('td', { className: 'border px-2 py-1', colSpan: 2 }, '')
                )
            )
        )
    );
}

function PettyCashModal({ open, onClose, entries, entry, setEntry, editingIndex, onAdd, onUpdate, onEdit, onDelete, onCancel, categories, t }) {
    React.useEffect(() => {
        const handler = e => { if (e.key === 'Escape') onClose(); };
        if (open) document.addEventListener('keydown', handler);
        return () => document.removeEventListener('keydown', handler);
    }, [open]);

    if (!open) return null;

    return React.createElement('div', {
        className: 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50',
        onClick: e => { if (e.target === e.currentTarget) onClose(); }
    },
        React.createElement('div', { className: 'bg-white p-6 rounded w-full max-w-2xl petty-cash-modal' },
            React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, t('managePettyCashEntries')),
            React.createElement(PettyCashEntryForm, {
                entry: entry,
                onChange: setEntry,
                onSubmit: editingIndex >= 0 ? onUpdate : onAdd,
                onCancel: onCancel,
                isEditing: editingIndex >= 0,
                categories: categories,
                t: t
            }),
            React.createElement(PettyCashEntriesList, { entries: entries, onEdit: onEdit, onDelete: onDelete, categories: categories, t: t }),
            React.createElement('div', { className: 'mt-4 text-right modal-actions' },
                React.createElement('button', { type: 'button', onClick: onClose, className: 'bg-gray-500 text-white px-4 py-2 rounded' }, t('close'))
            )
        )
    );
}

function BilingualEmployeeDailyEntryTab({ employeeSession }) {
    const { t } = React.useContext(window.LanguageContext);

    const validateTranslations = () => {
        const requiredKeys = [
            'pettyCash', 'addPettyCashEntry', 'category', 'description', 'amount', 'paidBy',
            'cashSales', 'cardSales', 'deliveryAggregator1', 'deliveryAggregator2', 'otherFoodRevenue',
            'pettyCashTotal', 'selectCategory', 'fieldRequired', 'amountMustBePositive', 'confirmDeleteEntry'
        ];
        requiredKeys.forEach(key => {
            if (!t(key) || t(key) === key) {
                console.warn(`Missing translation for key: ${key}`);
            }
        });
    };

    React.useEffect(() => {
        validateTranslations();
    }, []);
    
    const [formData, setFormData] = React.useState({
        shawarmaStack: {
            starting_weight: '',
            remaining_weight: '',
            shaving_weight: '',
            staff_meals_weight: '',
            orders_weight: ''
        },
        rawProteins: {
            frozen_chicken_breast_opening: '',
            frozen_chicken_breast_received: '',
            frozen_chicken_breast_expired: '',
            frozen_chicken_breast_remaining: '',
            chicken_shawarma_opening: '',
            chicken_shawarma_received: '',
            chicken_shawarma_expired: '',
            chicken_shawarma_remaining: '',
            steak_opening: '',
            steak_received: '',
            steak_expired: '',
            steak_remaining: ''
        },
        marinatedProteins: {
            fahita_chicken_opening: '',
            fahita_chicken_received: '',
            fahita_chicken_expired: '',
            fahita_chicken_remaining: '',
            chicken_sub_opening: '',
            chicken_sub_received: '',
            chicken_sub_expired: '',
            chicken_sub_remaining: '',
            spicy_strips_opening: '',
            spicy_strips_received: '',
            spicy_strips_expired: '',
            spicy_strips_remaining: '',
            original_strips_opening: '',
            original_strips_received: '',
            original_strips_expired: '',
                original_strips_remaining: '',
    // ADD THIS NEW SECTION:
    marinated_steak_opening: '',
    marinated_steak_received: '',
    marinated_steak_expired: '',
    marinated_steak_remaining: ''
        },
        bread: {
            saj_bread_opening: '',
            saj_bread_received: '',
            saj_bread_expired: '',
            saj_bread_remaining: '',
            pita_bread_opening: '',
            pita_bread_received: '',
            pita_bread_expired: '',
            pita_bread_remaining: '',
            bread_rolls_opening: '',
            bread_rolls_received: '',
            bread_rolls_expired: '',
            bread_rolls_remaining: ''
        },
        highCostItems: {
            cream_opening: '',
            cream_received: '',
            cream_expired: '',
            cream_remaining: '',
            mayo_opening: '',
            mayo_received: '',
            mayo_expired: '',
            mayo_remaining: ''
        },
        sales: {
            total_revenue: '',
            shawarma_revenue: '',
            cash_sales: '',
            card_sales: '',
            delivery_aggregator_1: '',
            delivery_aggregator_2: '',
            other_food_revenue: '',
            petty_cash_total: ''
        },
        notes: ''
    });
    
    const [loading, setLoading] = React.useState(false);
    const [selectedDate, setSelectedDate] = React.useState(new Date().toISOString().split('T')[0]);
    const [managementPin, setManagementPin] = React.useState('');
    const [showPinInput, setShowPinInput] = React.useState(false);
    const [duplicateWarning, setDuplicateWarning] = React.useState(false);
    const [isUpdateMode, setIsUpdateMode] = React.useState(false);
    const [loadingExistingData, setLoadingExistingData] = React.useState(false);
    const [checkingExistingData, setCheckingExistingData] = React.useState(false);
    const [fieldsLocked, setFieldsLocked] = React.useState(false);
    const [showLoadExistingPin, setShowLoadExistingPin] = React.useState(false);
    const [loadExistingPin, setLoadExistingPin] = React.useState('');
    const [pinError, setPinError] = React.useState(false);

    const [pettyCashEntries, setPettyCashEntries] = React.useState([]);
    const [showPettyCashModal, setShowPettyCashModal] = React.useState(false);
    const [currentPettyCashEntry, setCurrentPettyCashEntry] = React.useState({
        id: null,
        category: '',
        description: '',
        amount: '',
        paid_by: ''
    });
    const [editingEntryIndex, setEditingEntryIndex] = React.useState(-1);

    const getCurrentEmployeeId = () => {
        return employeeSession && employeeSession.employeeId ? employeeSession.employeeId : 'employee';
    };

    const convertInventoryDataToNestedFormat = (inventory) => {
        const result = { rawProteins: {}, marinatedProteins: {}, bread: {}, highCostItems: {} };
        const mappings = {
            chicken_breast: { category: 'rawProteins', legacy: 'frozen_chicken_breast' },
            chicken_shawarma: { category: 'rawProteins', legacy: 'chicken_shawarma' },
            steak: { category: 'rawProteins', legacy: 'steak' },
            fahita_chicken: { category: 'marinatedProteins', legacy: 'fahita_chicken' },
            chicken_sub: { category: 'marinatedProteins', legacy: 'chicken_sub' },
            spicy_strips: { category: 'marinatedProteins', legacy: 'spicy_strips' },
            original_strips: { category: 'marinatedProteins', legacy: 'original_strips' },
            marinated_steak: { category: 'marinatedProteins', legacy: 'marinated_steak' },
            saj_bread: { category: 'bread', legacy: 'saj_bread' },
            pita_bread: { category: 'bread', legacy: 'pita_bread' },
            bread_roll: { category: 'bread', legacy: 'bread_rolls' },
            cream: { category: 'highCostItems', legacy: 'cream' },
            mayo: { category: 'highCostItems', legacy: 'mayo' }
        };
        Object.keys(mappings).forEach(key => {
            const map = mappings[key];
            ['opening','received','expired','remaining'].forEach(suffix => {
                const flatKey = key + '_' + suffix;
                if (inventory && inventory.hasOwnProperty(flatKey)) {
                    result[map.category][map.legacy + '_' + suffix] = inventory[flatKey];
                }
            });
        });
        return result;
    };

    const INVENTORY_CONFIG = {
        rawProteins: {
            titleKey: 'frozenRawProteins',
            items: [
                { key: 'frozen_chicken_breast', labelKey: 'frozenChickenBreast', item_id: null },
                { key: 'chicken_shawarma', labelKey: 'chickenShawarma', item_id: null },
                { key: 'steak', labelKey: 'steak', item_id: null }
            ]
        },
        marinatedProteins: {
            titleKey: 'marinatedProteins',
            items: [
                { key: 'fahita_chicken', labelKey: 'fahitaChicken', item_id: null },
                { key: 'chicken_sub', labelKey: 'chickenSub', item_id: null },
                { key: 'spicy_strips', labelKey: 'spicyStrips', item_id: null },
                { key: 'original_strips', labelKey: 'originalStrips', item_id: null },
                { key: 'marinated_steak', labelKey: 'marinatedSteak', item_id: null }
            ]
        },
        bread: {
            titleKey: 'breadItems',
            items: [
                { key: 'saj_bread', labelKey: 'sajBread', item_id: null },
                { key: 'pita_bread', labelKey: 'pitaBread', item_id: null },
                { key: 'bread_rolls', labelKey: 'breadRolls', item_id: null }
            ]
        },
        highCostItems: {
            titleKey: 'highCostItems',
            items: [
                { key: 'cream', labelKey: 'cream', item_id: null },
                { key: 'mayo', labelKey: 'mayo', item_id: null }
            ]
        }
    };

    const PETTY_CASH_CATEGORIES = [
        { key: 'fuel', labelKey: 'categoryFuel' },
        { key: 'ingredients', labelKey: 'categoryIngredients' },
        { key: 'supplies', labelKey: 'categorySupplies' },
        { key: 'equipment', labelKey: 'categoryEquipment' },
        { key: 'utilities', labelKey: 'categoryUtilities' },
        { key: 'maintenance', labelKey: 'categoryMaintenance' },
        { key: 'transportation', labelKey: 'categoryTransportation' },
        { key: 'other', labelKey: 'categoryOther' }
    ];

    React.useEffect(() => {
        if (selectedDate) {
            checkExistingEntry();
        }
    }, [selectedDate]);
    
    React.useEffect(() => {
        if (!checkingExistingData && !duplicateWarning && selectedDate === new Date().toISOString().split('T')[0]) {
            loadPreviousDayData();
        }
    }, [checkingExistingData, duplicateWarning, selectedDate]);

    const loadItemMappings = () => {
        try {
            google.script.run
                .withSuccessHandler(mappings => {
                    Object.values(INVENTORY_CONFIG).forEach(section => {
                        section.items.forEach(item => {
                            if (mappings[item.key]) {
                                item.item_id = mappings[item.key];
                            }
                        });
                    });
                })
                .withFailureHandler(err => console.error('Error loading item mappings', err))
                .getAllLegacyKeyMappings();
        } catch (err) {
            console.error('Error loading item mappings', err);
        }
    };

    React.useEffect(() => {
        loadItemMappings();
    }, []);
    
    const checkExistingEntry = async () => {
        setCheckingExistingData(true);
        setIsUpdateMode(false);
        setDuplicateWarning(false);
        setFieldsLocked(true);
        setShowLoadExistingPin(false);
        setPinError(false);
        setLoadExistingPin('');
        
        try {
            await google.script.run
                .withSuccessHandler(result => {
                    const data = JSON.parse(result);
                    setCheckingExistingData(false);
                    
                    if (data.exists) {
                        setDuplicateWarning(true);
                        setFieldsLocked(true);
                        setShowLoadExistingPin(true);
                    } else {
                        resetFormToClean();
                    }
                })
                .withFailureHandler(error => {
                    setCheckingExistingData(false);
                    resetFormToClean();
                })
                .checkExistingEntry(selectedDate);
        } catch (error) {
            setCheckingExistingData(false);
            resetFormToClean();
        }
    };
    
    const loadPreviousDayData = async () => {
        if (selectedDate === new Date().toISOString().split('T')[0] && !duplicateWarning) {
            try {
                const previousDate = new Date(selectedDate);
                previousDate.setDate(previousDate.getDate() - 1);
                const prevDateString = previousDate.toISOString().split('T')[0];
                
                await google.script.run
                    .withSuccessHandler(result => {
                        const data = JSON.parse(result);
                        if (data && data.dataFound) {
                            setFormData(prev => ({
                                ...prev,
                                rawProteins: {
                                    ...prev.rawProteins,
                                    frozen_chicken_breast_opening: (data.rawProteins && data.rawProteins.frozen_chicken_breast_remaining) ? data.rawProteins.frozen_chicken_breast_remaining : '',
                                    chicken_shawarma_opening: (data.rawProteins && data.rawProteins.chicken_shawarma_remaining) ? data.rawProteins.chicken_shawarma_remaining : '',
                                    steak_opening: (data.rawProteins && data.rawProteins.steak_remaining) ? data.rawProteins.steak_remaining : ''
                                },
                                marinatedProteins: {
                                    ...prev.marinatedProteins,
                                    fahita_chicken_opening: (data.marinatedProteins && data.marinatedProteins.fahita_chicken_remaining) ? data.marinatedProteins.fahita_chicken_remaining : '',
                                    chicken_sub_opening: (data.marinatedProteins && data.marinatedProteins.chicken_sub_remaining) ? data.marinatedProteins.chicken_sub_remaining : '',
                                    spicy_strips_opening: (data.marinatedProteins && data.marinatedProteins.spicy_strips_remaining) ? data.marinatedProteins.spicy_strips_remaining : '',
                                    original_strips_opening: (data.marinatedProteins && data.marinatedProteins.original_strips_remaining) ? data.marinatedProteins.original_strips_remaining : '',
    // ADD THIS LINE:
    marinated_steak_opening: (data.marinatedProteins && data.marinatedProteins.marinated_steak_remaining) ? data.marinatedProteins.marinated_steak_remaining : ''
                                },
                                bread: {
                                    ...prev.bread,
                                    saj_bread_opening: (data.bread && data.bread.saj_bread_remaining) ? data.bread.saj_bread_remaining : '',
                                    pita_bread_opening: (data.bread && data.bread.pita_bread_remaining) ? data.bread.pita_bread_remaining : '',
                                    bread_rolls_opening: (data.bread && data.bread.bread_rolls_remaining) ? data.bread.bread_rolls_remaining : ''
                                },
                                highCostItems: {
                                    ...prev.highCostItems,
                                    cream_opening: (data.highCostItems && data.highCostItems.cream_remaining) ? data.highCostItems.cream_remaining : '',
                                    mayo_opening: (data.highCostItems && data.highCostItems.mayo_remaining) ? data.highCostItems.mayo_remaining : ''
                                }
                            }));
                        }
                    })
                    .withFailureHandler(error => {
                        console.error('Error loading previous day data:', error);
                    })
                    .generateDailyReport(prevDateString);
            } catch (error) {
                console.error('Error loading previous day data:', error);
            }
        }
    };
    
    const confirmLoadExistingData = async () => {
        if (!loadExistingPin || loadExistingPin.trim() === '') {
            return;
        }
        
        setLoadingExistingData(true);
        setPinError(false);
        
        try {
            await google.script.run
                .withSuccessHandler(isValid => {
                    if (!isValid) {
                        setLoadingExistingData(false);
                        setPinError(true);
                        return;
                    }
                    
                    google.script.run
                        .withSuccessHandler(dataResult => {
                            const data = JSON.parse(dataResult);
                            
                            if (data.dataFound) {
                                const nestedInventory = convertInventoryDataToNestedFormat(data.inventory || {});
                                setFormData({
                                    shawarmaStack: {
                                        starting_weight: data.shawarma ? String(data.shawarma.starting_weight_kg || "") : "",
                                        remaining_weight: data.shawarma ? String(data.shawarma.remaining_weight_kg || "") : "",
                                        shaving_weight: data.shawarma ? String(data.shawarma.shaving_weight_kg || "") : "",
                                        staff_meals_weight: data.shawarma ? String(data.shawarma.staff_meals_weight_kg || "") : "",
                                        orders_weight: data.shawarma ? String(data.shawarma.orders_weight_kg || "") : ""
                                    },
                                    sales: {
                                        total_revenue: data.sales ? String(data.sales.total_revenue || "") : "",
                                        shawarma_revenue: data.sales ? String(data.sales.shawarma_revenue || "") : "",
                                        cash_sales: data.sales ? String(data.sales.cash_sales || "") : "",
                                        card_sales: data.sales ? String(data.sales.card_sales || "") : "",
                                        delivery_aggregator_1: data.sales ? String(data.sales.delivery_aggregator_1 || "") : "",
                                        delivery_aggregator_2: data.sales ? String(data.sales.delivery_aggregator_2 || "") : "",
                                        other_food_revenue: data.sales ? String(data.sales.other_food_revenue || "") : "",
                                        petty_cash_total: data.sales ? String(data.sales.petty_cash_total || "") : ""
                                    },
                                    rawProteins: nestedInventory.rawProteins,
                                    marinatedProteins: nestedInventory.marinatedProteins,
                                    bread: nestedInventory.bread,
                                    highCostItems: nestedInventory.highCostItems,
                                    notes: data.notes || ""
                                });
                                setPettyCashEntries(data.pettyCashEntries || []);
                            }

                            setFieldsLocked(false);
                            setDuplicateWarning(false);
                            setIsUpdateMode(true);
                            setShowLoadExistingPin(false);
                            setLoadExistingPin('');
                            setLoadingExistingData(false);
                            setPinError(false);
                        })
                        .withFailureHandler(error => {
                            setLoadingExistingData(false);
                        })
                        .generateDailyReport(selectedDate);
                })
                .withFailureHandler(error => {
                    setLoadingExistingData(false);
                    setPinError(true);
                })
                .validateManagementPin(loadExistingPin);
        } catch (error) {
            setLoadingExistingData(false);
            setPinError(true);
        }
    };

    const resetFormToClean = () => {
        setFormData({
            shawarmaStack: {
                starting_weight: '', remaining_weight: '', shaving_weight: '',
                staff_meals_weight: '', orders_weight: ''
            },
            rawProteins: {
                frozen_chicken_breast_opening: '', frozen_chicken_breast_received: '', 
                frozen_chicken_breast_expired: '', frozen_chicken_breast_remaining: '',
                chicken_shawarma_opening: '', chicken_shawarma_received: '', 
                chicken_shawarma_expired: '', chicken_shawarma_remaining: '',
                steak_opening: '', steak_received: '', steak_expired: '', steak_remaining: ''
            },
            marinatedProteins: {
                fahita_chicken_opening: '', fahita_chicken_received: '', fahita_chicken_expired: '', fahita_chicken_remaining: '',
                chicken_sub_opening: '', chicken_sub_received: '', chicken_sub_expired: '', chicken_sub_remaining: '',
                spicy_strips_opening: '', spicy_strips_received: '', spicy_strips_expired: '', spicy_strips_remaining: '',
                original_strips_opening: '', original_strips_received: '', original_strips_expired: '', original_strips_remaining: '',
    // ADD THESE LINES:
    marinated_steak_opening: '', marinated_steak_received: '', marinated_steak_expired: '', marinated_steak_remaining: ''
},
            bread: {
                saj_bread_opening: '', saj_bread_received: '', saj_bread_expired: '', saj_bread_remaining: '',
                pita_bread_opening: '', pita_bread_received: '', pita_bread_expired: '', pita_bread_remaining: '',
                bread_rolls_opening: '', bread_rolls_received: '', bread_rolls_expired: '', bread_rolls_remaining: ''
            },
            highCostItems: {
                cream_opening: '', cream_received: '', cream_expired: '', cream_remaining: '',
                mayo_opening: '', mayo_received: '', mayo_expired: '', mayo_remaining: ''
            },
            sales: {
                total_revenue: '',
                shawarma_revenue: '',
                cash_sales: '',
                card_sales: '',
                delivery_aggregator_1: '',
                delivery_aggregator_2: '',
                other_food_revenue: '',
                petty_cash_total: ''
            },
            notes: ''
        });
        
        setDuplicateWarning(false);
        setIsUpdateMode(false);
        setFieldsLocked(false);
        setShowLoadExistingPin(false);
        setLoadExistingPin('');
        setLoadingExistingData(false);
        setPinError(false);
        setPettyCashEntries([]);
    };
    
    const handleInputChange = (section, field, value) => {
        const normalized = normalizeNumberInput(value);
        setFormData(prev => ({
            ...prev,
            [section]: {
                ...prev[section],
                [field]: normalized
            }
        }));
    };
    
    const handleSubmit = async (e) => {
        e.preventDefault();
        
        if (isUpdateMode && !showPinInput) {
            setShowPinInput(true);
            return;
        }

        if (isUpdateMode && showPinInput) {
            if (!managementPin || managementPin.trim() === '') {
                alert(t('pinRequiredToUpdate'));
                return;
            }
        }
        
        setLoading(true);
        
        try {
            const inventory = {
                chicken_breast_remaining: formData.rawProteins.frozen_chicken_breast_remaining,
                chicken_breast_received: formData.rawProteins.frozen_chicken_breast_received,
                chicken_shawarma_remaining: formData.rawProteins.chicken_shawarma_remaining,
                chicken_shawarma_received: formData.rawProteins.chicken_shawarma_received,
                steak_remaining: formData.rawProteins.steak_remaining,
                steak_received: formData.rawProteins.steak_received,
                fahita_chicken_remaining: formData.marinatedProteins.fahita_chicken_remaining,
                fahita_chicken_received: formData.marinatedProteins.fahita_chicken_received,
                chicken_sub_remaining: formData.marinatedProteins.chicken_sub_remaining,
                chicken_sub_received: formData.marinatedProteins.chicken_sub_received,
                spicy_strips_remaining: formData.marinatedProteins.spicy_strips_remaining,
                spicy_strips_received: formData.marinatedProteins.spicy_strips_received,
                original_strips_remaining: formData.marinatedProteins.original_strips_remaining,
                original_strips_received: formData.marinatedProteins.original_strips_received,
                marinated_steak_remaining: formData.marinatedProteins.marinated_steak_remaining,
                marinated_steak_received: formData.marinatedProteins.marinated_steak_received,
                saj_bread_remaining: formData.bread.saj_bread_remaining,
                saj_bread_received: formData.bread.saj_bread_received,
                pita_bread_remaining: formData.bread.pita_bread_remaining,
                pita_bread_received: formData.bread.pita_bread_received,
                bread_roll_remaining: formData.bread.bread_rolls_remaining,
                bread_roll_received: formData.bread.bread_rolls_received,
                cream_remaining: formData.highCostItems.cream_remaining,
                cream_received: formData.highCostItems.cream_received,
                mayo_remaining: formData.highCostItems.mayo_remaining,
                mayo_received: formData.highCostItems.mayo_received
            };

            const entryData = {
                date: selectedDate,
                shawarmaStack: formData.shawarmaStack,
                sales: {
                    ...formData.sales,
                    other_food_revenue: calculateOtherFoodRevenue(),
                    petty_cash_total: calculatePettyCashTotal()
                },
                pettyCashEntries: pettyCashEntries,
                inventory: inventory,
                notes: formData.notes,
                isUpdate: isUpdateMode,
                managementPin: isUpdateMode ? managementPin : null,
                employeeId: getCurrentEmployeeId()
            };
            
            await google.script.run
                .withSuccessHandler(result => {
                    const response = JSON.parse(result);
                    alert(response.message);
                    
                    if (response.success) {
                        resetForm();
                        setDuplicateWarning(false);
                        setShowPinInput(false);
                        setManagementPin('');
                        setSelectedDate(new Date().toISOString().split('T')[0]);
                    }
                    setLoading(false);
                })
                .withFailureHandler(error => {
                    alert('Error saving entry: ' + error.message);
                    setLoading(false);
                })
                .saveDailyEntryWithEnhancedLogging(entryData);
                
        } catch (error) {
            alert('Error submitting form: ' + error.message);
            setLoading(false);
        }
    };
    
    const resetForm = () => {
        setFormData({
            shawarmaStack: {
                starting_weight: '', remaining_weight: '', shaving_weight: '',
                staff_meals_weight: '', orders_weight: ''
            },
            rawProteins: {
                frozen_chicken_breast_opening: '', frozen_chicken_breast_received: '', frozen_chicken_breast_expired: '', frozen_chicken_breast_remaining: '',
                chicken_shawarma_opening: '', chicken_shawarma_received: '', chicken_shawarma_expired: '', chicken_shawarma_remaining: '',
                steak_opening: '', steak_received: '', steak_expired: '', steak_remaining: ''
            },
            marinatedProteins: {
                fahita_chicken_opening: '', fahita_chicken_received: '', fahita_chicken_expired: '', fahita_chicken_remaining: '',
                chicken_sub_opening: '', chicken_sub_received: '', chicken_sub_expired: '', chicken_sub_remaining: '',
                spicy_strips_opening: '', spicy_strips_received: '', spicy_strips_expired: '', spicy_strips_remaining: '',
                original_strips_opening: '', original_strips_received: '', original_strips_expired: '', original_strips_remaining: '',
    // ADD THESE LINES:
    marinated_steak_opening: '', marinated_steak_received: '', marinated_steak_expired: '', marinated_steak_remaining: ''
            },
            bread: {
                saj_bread_opening: '', saj_bread_received: '', saj_bread_expired: '', saj_bread_remaining: '',
                pita_bread_opening: '', pita_bread_received: '', pita_bread_expired: '', pita_bread_remaining: '',
                bread_rolls_opening: '', bread_rolls_received: '', bread_rolls_expired: '', bread_rolls_remaining: ''
            },
            highCostItems: {
                cream_opening: '', cream_received: '', cream_expired: '', cream_remaining: '',
                mayo_opening: '', mayo_received: '', mayo_expired: '', mayo_remaining: ''
            },
            sales: {
                total_revenue: '',
                shawarma_revenue: '',
                cash_sales: '',
                card_sales: '',
                delivery_aggregator_1: '',
                delivery_aggregator_2: '',
                other_food_revenue: '',
                petty_cash_total: ''
            },
            notes: ''
        });
        setPettyCashEntries([]);
        setIsUpdateMode(false);
    };
    
    const cancelUpdate = () => {
        setShowPinInput(false);
        setManagementPin('');
        setFieldsLocked(false);
    };

    const calculateOtherFoodRevenue = () => {
        const total = parseFloat(formData.sales.total_revenue) || 0;
        const shawarma = parseFloat(formData.sales.shawarma_revenue) || 0;
        return total - shawarma;
    };

    const calculatePettyCashTotal = () => {
        return pettyCashEntries.reduce((sum, e) => sum + (parseFloat(e.amount) || 0), 0);
    };

    const handleAddPettyCashEntry = () => {
        const { category, description, amount, paid_by } = currentPettyCashEntry;
        if (!category || !description || !amount || !paid_by) {
            alert(t('fieldRequired'));
            return;
        }
        if (parseFloat(amount) <= 0) {
            alert(t('amountMustBePositive'));
            return;
        }
        setPettyCashEntries([...pettyCashEntries, { ...currentPettyCashEntry, id: Date.now().toString() }]);
        resetPettyCashForm();
    };

    const handleEditPettyCashEntry = (index) => {
        setCurrentPettyCashEntry(pettyCashEntries[index]);
        setEditingEntryIndex(index);
    };

    const handleUpdatePettyCashEntry = () => {
        if (editingEntryIndex < 0) return;
        const updated = [...pettyCashEntries];
        updated[editingEntryIndex] = currentPettyCashEntry;
        setPettyCashEntries(updated);
        resetPettyCashForm();
    };

    const handleDeletePettyCashEntry = (index) => {
        if (confirm(t('confirmDeleteEntry'))) {
            setPettyCashEntries(pettyCashEntries.filter((_, i) => i !== index));
        }
    };

    const handleCancelPettyCashEdit = () => {
        resetPettyCashForm();
    };

    const resetPettyCashForm = () => {
        setCurrentPettyCashEntry({ id: null, category: '', description: '', amount: '', paid_by: '' });
        setEditingEntryIndex(-1);
    };

    React.useEffect(() => {
        setFormData(prev => ({
            ...prev,
            sales: { ...prev.sales, petty_cash_total: String(calculatePettyCashTotal().toFixed(2)) }
        }));
    }, [pettyCashEntries]);
    
    const renderInventorySection = (titleKey, sectionKey, items, unit) => {
        return React.createElement('div', {
            className: 'mb-6'
        },
            React.createElement('h4', {
                className: 'font-medium text-gray-700 mb-3'
            }, t(titleKey)),
            React.createElement('div', {
                className: 'overflow-x-auto'
            },
                React.createElement('table', {
                    className: 'min-w-full border-collapse'
                },
                    React.createElement('thead', null,
                        React.createElement('tr', {
                            className: 'bg-gray-50'
                        },
                            React.createElement('th', {
                                className: 'border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-600 w-32'
                            }, t('item')),
                            
                            React.createElement('th', {
                                className: 'border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-600 w-20'
                            }, t('received')),
                            React.createElement('th', {
                                className: 'border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-600 w-20'
                            }, t('expired')),
                            React.createElement('th', {
                                className: 'border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-600 w-20'
                            }, t('remaining'))
                        )
                    ),
                    React.createElement('tbody', null,
                        items.map(item => 
                            React.createElement('tr', {
                                key: item.key,
                                className: 'hover:bg-gray-50'
                            },
                                React.createElement('td', {
                                    className: 'border border-gray-200 px-3 py-2 text-sm font-medium text-gray-700'
                                }, t(item.labelKey)),
                               
                                React.createElement('td', {
                                    className: 'border border-gray-200 px-2 py-1'
                                },
                                    React.createElement('input', {
                                        type: 'number',
                                        step: unit === 'kg' ? '0.001' : '1',
                                        value: formData[sectionKey][item.key + '_received'],
                                        onChange: e => handleInputChange(sectionKey, item.key + '_received', e.target.value),
                                        className: 'w-full p-1 border rounded text-xs' + (fieldsLocked ? ' bg-gray-100 opacity-50' : ''),
                                        placeholder: '0',
                                        disabled: fieldsLocked
                                    })
                                ),
                                React.createElement('td', {
                                    className: 'border border-gray-200 px-2 py-1'
                                },
                                    React.createElement('input', {
                                        type: 'number',
                                        step: unit === 'kg' ? '0.001' : '1',
                                        value: formData[sectionKey][item.key + '_expired'],
                                        onChange: e => handleInputChange(sectionKey, item.key + '_expired', e.target.value),
                                        className: 'w-full p-1 border rounded text-xs' + (fieldsLocked ? ' bg-gray-100' : ''),
                                        placeholder: '0',
                                        disabled: fieldsLocked
                                    })
                                ),
                                React.createElement('td', {
                                    className: 'border border-gray-200 px-2 py-1'
                                },
                                    React.createElement('input', {
                                        type: 'number',
                                        step: unit === 'kg' ? '0.001' : '1',
                                        value: formData[sectionKey][item.key + '_remaining'],
                                        onChange: e => handleInputChange(sectionKey, item.key + '_remaining', e.target.value),
                                        className: 'w-full p-1 border rounded text-xs' + (fieldsLocked ? ' bg-gray-100' : ''),
                                        placeholder: '0',
                                        required: true,
                                        disabled: fieldsLocked
                                    })
                                )
                            )
                        )
                    )
                )
            )
        );
    };
    
    return React.createElement('div', {
        className: 'max-w-6xl mx-auto space-y-6'
    },
        React.createElement(PettyCashModal, {
            open: showPettyCashModal,
            onClose: () => { setShowPettyCashModal(false); handleCancelPettyCashEdit(); },
            entries: pettyCashEntries,
            entry: currentPettyCashEntry,
            setEntry: setCurrentPettyCashEntry,
            editingIndex: editingEntryIndex,
            onAdd: handleAddPettyCashEntry,
            onUpdate: handleUpdatePettyCashEntry,
            onEdit: handleEditPettyCashEntry,
            onDelete: handleDeletePettyCashEntry,
            onCancel: handleCancelPettyCashEdit,
            categories: PETTY_CASH_CATEGORIES,
            t: t
        }),
        React.createElement('div', {
            className: 'bg-white rounded-lg shadow p-6'
        },
            React.createElement('h2', {
                className: 'text-2xl font-bold text-gray-800 mb-6'
            }, t('dailyOperationsEntry')),
            
            React.createElement('div', {
                className: 'mb-6 p-4 bg-blue-50 rounded-lg'
            },
                React.createElement('div', {
                    className: 'flex items-center gap-4'
                },
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block text-sm font-medium mb-1'
                        }, t('selectDate')),
                        React.createElement('input', {
                            type: 'date',
                            value: selectedDate,
                            max: new Date().toISOString().split('T')[0],
                            onChange: e => setSelectedDate(e.target.value),
                            className: 'p-2 border rounded focus:ring-2 focus:ring-blue-500'
                        })
                    ),
                    
                    checkingExistingData && React.createElement('div', {
                        className: 'flex items-center gap-2 text-gray-600'
                    },
                        React.createElement('div', {
                            className: 'animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600'
                        }),
                        React.createElement('span', {
                            className: 'text-sm'
                        }, t('checkingForExistingData'))
                    ),
                    
                    !checkingExistingData && React.createElement('div', {
                        className: 'flex-1'
                    },
                        duplicateWarning && showLoadExistingPin && React.createElement('div', {
                            className: 'bg-yellow-100 border border-yellow-400 rounded p-3'
                        },
                            React.createElement('div', {
                                className: 'flex items-center gap-2 mb-3'
                            },
                                React.createElement('span', {
                                    className: 'text-yellow-600'
                                }, '⚠️'),
                                React.createElement('div', {
                                    className: 'flex-1'
                                },
                                    React.createElement('p', {
                                        className: 'font-medium text-yellow-800'
                                    }, t('entryExistsFor') + ' ' + selectedDate),
                                    React.createElement('p', {
                                        className: 'text-sm text-yellow-600'
                                    }, t('enterManagementPinToLoad'))
                                )
                            ),
                            
                            React.createElement('div', {
                                className: 'bg-blue-50 border border-blue-300 rounded-lg p-3'
                            },
                                React.createElement('h4', {
                                    className: 'text-sm font-semibold text-blue-800 mb-2'
                                }, '🔐 ' + t('managementPin')),
                                
                                loadingExistingData ? React.createElement('div', {
                                    className: 'flex items-center gap-2 text-blue-600'
                                },
                                    React.createElement('div', {
                                        className: 'animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600'
                                    }),
                                    React.createElement('span', {
                                        className: 'text-sm'
                                    }, t('loadingData'))
                                ) : React.createElement('div', null,
                                    React.createElement('div', {
                                        className: 'flex items-center gap-2'
                                    },
                                        React.createElement('input', {
                                            type: 'password',
                                            value: loadExistingPin,
                                            onChange: e => {
                                                setLoadExistingPin(e.target.value);
                                                if (pinError) {
                                                    setPinError(false);
                                                }
                                            },
                                            onKeyPress: e => {
                                                if (e.key === 'Enter' && loadExistingPin.trim()) {
                                                    confirmLoadExistingData();
                                                }
                                            },
                                            className: 'flex-1 p-2 border rounded text-sm',
                                            placeholder: t('enterPin')
                                        }),
                                        React.createElement('button', {
                                            type: 'button',
                                            onClick: confirmLoadExistingData,
                                            disabled: !loadExistingPin,
                                            className: 'bg-blue-600 text-white px-3 py-2 rounded text-sm disabled:opacity-50'
                                        }, t('unlock'))
                                    ),
                                    
                                    pinError && React.createElement('div', {
                                        className: 'mt-2'
                                    },
                                        React.createElement('p', {
                                            className: 'text-xs text-red-600'
                                        }, t('incorrectPin'))
                                    )
                                )
                            )
                        ),
                        
                        !duplicateWarning && selectedDate !== new Date().toISOString().split('T')[0] && React.createElement('div', {
                            className: 'bg-green-100 border border-green-400 rounded p-3'
                        },
                            React.createElement('div', {
                                className: 'flex items-center gap-2'
                            },
                                React.createElement('span', {
                                    className: 'text-green-600'
                                }, '✅'),
                                React.createElement('p', {
                                    className: 'text-green-800 text-sm'
                                }, t('dataLoadedFor') + ' ' + selectedDate + ' - ' + t('formReadyForEditing'))
                            )
                        ),
                        
                        !duplicateWarning && selectedDate === new Date().toISOString().split('T')[0] && React.createElement('div', {
                            className: 'bg-blue-100 border border-blue-400 rounded p-3'
                        },
                            React.createElement('div', {
                                className: 'flex items-center gap-2'
                            },
                                React.createElement('span', {
                                    className: 'text-blue-600'
                                }, '📝'),
                                React.createElement('p', {
                                    className: 'text-blue-800 text-sm'
                                }, t('readyForNewEntry') + ' - ' + selectedDate)
                            )
                        )
                    )
                )
            ),
            
            React.createElement('form', {
                onSubmit: handleSubmit,
                className: 'space-y-8'
            },
                
                React.createElement('div', {
                    className: 'border border-gray-200 rounded-lg p-6 sales-breakdown'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-gray-800 mb-4'
                    }, '🥙 ' + t('shawarmaStackManagement')),
                    
                    React.createElement('div', {
                        className: 'grid grid-cols-2 md:grid-cols-5 gap-4'
                    },
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: 'block text-sm font-medium mb-1'
                            }, t('startingWeight')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.001',
                                value: formData.shawarmaStack.starting_weight,
                                onChange: e => handleInputChange('shawarmaStack', 'starting_weight', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                required: true,
                                disabled: fieldsLocked
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: 'block text-sm font-medium mb-1'
                            }, t('ordersWeight')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.001',
                                value: formData.shawarmaStack.orders_weight,
                                onChange: e => handleInputChange('shawarmaStack', 'orders_weight', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                disabled: fieldsLocked
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: 'block text-sm font-medium mb-1'
                            }, t('shavingWeight')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.001',
                                value: formData.shawarmaStack.shaving_weight,
                                onChange: e => handleInputChange('shawarmaStack', 'shaving_weight', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                disabled: fieldsLocked
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: 'block text-sm font-medium mb-1'
                            }, t('staffMeals')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.001',
                                value: formData.shawarmaStack.staff_meals_weight,
                                onChange: e => handleInputChange('shawarmaStack', 'staff_meals_weight', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                disabled: fieldsLocked
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: 'block text-sm font-medium mb-1'
                            }, t('remainingWeight')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.001',
                                value: formData.shawarmaStack.remaining_weight,
                                onChange: e => handleInputChange('shawarmaStack', 'remaining_weight', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                required: true,
                                disabled: fieldsLocked
                            })
                        )
                    )
                ),
                
                React.createElement('div', {
                    className: 'border border-gray-200 rounded-lg p-6'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-gray-800 mb-4'
                    }, '🥩 ' + t('rawProteins')),
                    
                    renderInventorySection(
                        INVENTORY_CONFIG.rawProteins.titleKey,
                        'rawProteins',
                        INVENTORY_CONFIG.rawProteins.items,
                        'kg'
                    )
                ),
                
                React.createElement('div', {
                    className: 'border border-gray-200 rounded-lg p-6'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-gray-800 mb-4'
                    }, '🍖 ' + t('marinatedReadyToUse')),
                    
                    renderInventorySection(
                        INVENTORY_CONFIG.marinatedProteins.titleKey,
                        'marinatedProteins',
                        INVENTORY_CONFIG.marinatedProteins.items,
                        'kg'
                    )
                ),
                
                React.createElement('div', {
                    className: 'border border-gray-200 rounded-lg p-6'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-gray-800 mb-4'
                    }, '🍞 ' + t('dailyBreadTracking')),
                    
                    renderInventorySection(
                        INVENTORY_CONFIG.bread.titleKey,
                        'bread',
                        INVENTORY_CONFIG.bread.items,
                        'pieces'
                    )
                ),
                
                React.createElement('div', {
                    className: 'border border-gray-200 rounded-lg p-6'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-gray-800 mb-4'
                    }, '💰 ' + t('highCostItems')),
                    
                    renderInventorySection(
                        INVENTORY_CONFIG.highCostItems.titleKey,
                        'highCostItems',
                        INVENTORY_CONFIG.highCostItems.items,
                        'kg'
                    )
                ),
                
                React.createElement('div', {
                    className: 'border border-gray-200 rounded-lg p-6'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-gray-800 mb-4'
                    }, '💵 ' + t('dailySales')),
                    
                    React.createElement('div', {
                        className: 'grid grid-cols-1 md:grid-cols-2 gap-4'
                    },
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('totalDailyRevenue')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: formData.sales.total_revenue,
                                onChange: e => handleInputChange('sales', 'total_revenue', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                required: true,
                                disabled: fieldsLocked
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('shawarmaRevenue')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: formData.sales.shawarma_revenue,
                                onChange: e => handleInputChange('sales', 'shawarma_revenue', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                required: true,
                                disabled: fieldsLocked
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('cashSales')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: formData.sales.cash_sales,
                                onChange: e => handleInputChange('sales', 'cash_sales', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                disabled: fieldsLocked
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('cardSales')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: formData.sales.card_sales,
                                onChange: e => handleInputChange('sales', 'card_sales', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                disabled: fieldsLocked
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('deliveryAggregator1')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: formData.sales.delivery_aggregator_1,
                                onChange: e => handleInputChange('sales', 'delivery_aggregator_1', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                disabled: fieldsLocked
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('deliveryAggregator2')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: formData.sales.delivery_aggregator_2,
                                onChange: e => handleInputChange('sales', 'delivery_aggregator_2', e.target.value),
                                className: 'w-full p-2 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                                disabled: fieldsLocked
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('otherFoodRevenue')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: calculateOtherFoodRevenue().toFixed(2),
                                readOnly: true,
                                className: 'w-full p-2 border rounded bg-gray-100',
                                disabled: true
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, t('pettyCashTotal')),
                            React.createElement('input', {
                                type: 'number',
                                step: '0.01',
                                value: calculatePettyCashTotal().toFixed(2),
                                readOnly: true,
                                className: 'w-full p-2 border rounded bg-gray-100',
                                disabled: true
                            })
                        )
                    ),

                    React.createElement('div', { className: 'mt-4' },
                        React.createElement('button', {
                            type: 'button',
                            className: 'bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50',
                            onClick: () => setShowPettyCashModal(true),
                            disabled: fieldsLocked
                        }, t('pettyCash') + ': ' + calculatePettyCashTotal().toFixed(2) + ' QAR (' + pettyCashEntries.length + ' ' + t('entries') + ')')
                    )
                ),
                
                React.createElement('div', {
                    className: 'border border-gray-200 rounded-lg p-6'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-gray-800 mb-4'
                    }, '📝 ' + t('dailyNotes')),
                    React.createElement('textarea', {
                        value: formData.notes,
                        onChange: e => setFormData(prev => ({ ...prev, notes: e.target.value })),
                        className: 'w-full p-3 border rounded focus:ring-2 focus:ring-redbrand-500' + (fieldsLocked ? ' bg-gray-100' : ''),
                        rows: '3',
                        placeholder: t('anyObservations'),
                        disabled: fieldsLocked
                    })
                ),
                
                showPinInput && React.createElement('div', {
                    className: 'border border-yellow-400 bg-yellow-50 rounded-lg p-6'
                },
                    React.createElement('h3', {
                        className: 'text-lg font-semibold text-yellow-800 mb-4'
                    }, '🔐 ' + t('managementAuthRequired')),
                    React.createElement('div', {
                        className: 'max-w-md'
                    },
                        React.createElement('label', {
                            className: 'block text-sm font-medium mb-1'
                        }, t('enterManagementPin')),
                        React.createElement('input', {
                            type: 'password',
                            value: managementPin,
                            onChange: e => setManagementPin(e.target.value),
                            className: 'w-full p-3 border rounded focus:ring-2 focus:ring-yellow-500',
                            placeholder: t('enterPin'),
                            maxLength: '20'
                        }),
                        React.createElement('p', {
                            className: 'text-sm text-yellow-600 mt-2'
                        }, t('pinToUpdateEntry') + ' ' + selectedDate)
                    )
                ),
                
                React.createElement('div', {
                    className: 'flex justify-end space-x-4'
                },
                    showPinInput && React.createElement('button', {
                        type: 'button',
                        onClick: cancelUpdate,
                        className: 'bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600'
                    }, t('cancelUpdate')),
                    React.createElement('button', {
                        type: 'submit',
                        disabled: loading || fieldsLocked || (showPinInput && !managementPin),
                        className: 'bg-redbrand-600 text-white px-8 py-3 rounded-lg hover:bg-redbrand-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2'
                    },
                        loading ? React.createElement(React.Fragment, null,
                            React.createElement('div', {
                                className: 'animate-spin rounded-full h-4 w-4 border-b-2 border-white'
                            }),
                            isUpdateMode ? t('updating') : t('saving')
                        ) : React.createElement(React.Fragment, null,
                            fieldsLocked ? t('loadDataFirst') : (isUpdateMode ? t('updateEntry') : t('saveEntry')),
                            showPinInput && !managementPin && ' ' + t('pinRequired')
                        )
                    )
                )
            )
        )
    );
}

// Make the component available globally
window.EmployeeDailyEntryTab = BilingualEmployeeDailyEntryTab;
</script>