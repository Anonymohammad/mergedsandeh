
<script type="text/babel">
function ManagementDashboard() {
    const { state } = React.useContext(window.AppContext);
    const [dashboardData, setDashboardData] = React.useState(null);
    const [selectedPeriod, setSelectedPeriod] = React.useState('today');
    const [customDate, setCustomDate] = React.useState('');
    const [alerts, setAlerts] = React.useState([]);
    const [loading, setLoading] = React.useState(true);
    const [cardLoading, setCardLoading] = React.useState({
        metrics: true,
        shawarma: true,
        sales: true,
        inventory: true
    });
    const [showDataStatus, setShowDataStatus] = React.useState(false);
    const [showDebugData, setShowDebugData] = React.useState(false);

    React.useEffect(() => {
        if (selectedPeriod !== 'custom' || (selectedPeriod === 'custom' && customDate)) {
            loadDashboardData();
        }
    }, [selectedPeriod, customDate]);

    const getAcceptableRemainingRange = (stackWeightKg) => {
        return {
            min: 0.6,
            max: 0.85,
            optimal: Math.min(0.8, stackWeightKg * 0.06)
        };
    };

    const getAcceptableLossRange = () => {
        return { min: 12, max: 28 };
    };

    const getAcceptableTotalWasteRange = (stackWeightKg) => {
        const lossRange = getAcceptableLossRange();
        const remainingRange = getAcceptableRemainingRange(stackWeightKg);
        const minTotalWaste = lossRange.min + (remainingRange.min / stackWeightKg * 100);
        const maxTotalWaste = lossRange.max + (remainingRange.max / stackWeightKg * 100);
        return {
            min: Math.round(minTotalWaste * 10) / 10,
            max: Math.round(maxTotalWaste * 10) / 10
        };
    };

    const computeShawarmaMetrics = (shawarma) => {
        if (!shawarma || !shawarma.starting_weight_kg) return shawarma;

        const startingWeight = parseFloat(shawarma.starting_weight_kg) || 0;
        const remainingWeight = parseFloat(shawarma.remaining_weight_kg) || 0;
        const shavingWeight = parseFloat(shawarma.shaving_weight_kg) || 0;
        const staffMealsWeight = parseFloat(shawarma.staff_meals_weight_kg) || 0;
        const ordersWeight = parseFloat(shawarma.orders_weight_kg) || 0;

        const revenueQar = parseFloat(shawarma.revenue_qar) || 0;


        const lossWeight = startingWeight - (ordersWeight + shavingWeight + staffMealsWeight + remainingWeight);
        const lossPercentage = startingWeight > 0 ? (lossWeight / startingWeight) * 100 : 0;

        const totalWasteWeight = lossWeight + remainingWeight;
        const totalWastePercentage = startingWeight > 0 ? (totalWasteWeight / startingWeight) * 100 : 0;


        const revenuePerKg = ordersWeight > 0 ? revenueQar / ordersWeight : 0;
        const costPerKg = startingWeight > 0 ? (shawarma.stack_cost_qar || 0) / startingWeight : 0;
        const profitPerKg = revenuePerKg - costPerKg;

        return {
            ...shawarma,
            loss_weight_kg: lossWeight,
            loss_percentage: lossPercentage,
            waste_weight_kg: totalWasteWeight,
            waste_percentage: totalWastePercentage,

            revenue_per_kg: revenuePerKg,
            profit_per_kg: profitPerKg,
            total_waste_range: getAcceptableTotalWasteRange(startingWeight),
            remaining_range: getAcceptableRemainingRange(startingWeight)

        };
    };

    const loadDashboardData = async () => {
        // Only show card loading for refreshes, not initial load
        if (dashboardData) {
            setCardLoading({
                metrics: true,
                shawarma: true,
                sales: true,
                inventory: true
            });
        } else {
            setLoading(true);
        }

        try {
            let dateParam = null;

            console.log("Selected period:", selectedPeriod);
            console.log("Custom date:", customDate);

            const formatISO = (d) => d.toISOString().split('T')[0];

            if (selectedPeriod === 'custom' && customDate) {
                dateParam = formatISO(new Date(customDate));
            } else if (selectedPeriod === 'today') {
                dateParam = formatISO(new Date());
            } else if (selectedPeriod === 'yesterday') {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                dateParam = formatISO(yesterday);
            } else if (selectedPeriod === 'week') {
                dateParam = formatISO(new Date());
            } else if (selectedPeriod === 'month') {
                dateParam = formatISO(new Date());
            }

            console.log("Requesting dashboard data for date:", dateParam);

            await google.script.run
                .withSuccessHandler(data => {
                    console.log("Received dashboard data:", data);
                    try {
                        const parsedData = JSON.parse(data);

                        if (parsedData.shawarma) {
                            parsedData.shawarma = computeShawarmaMetrics(parsedData.shawarma);
                        }

                        if (parsedData.enhanced_analytics) {
                            parsedData.processed_analytics = processEnhancedAnalytics(parsedData.enhanced_analytics);
                        }

                        setDashboardData(parsedData);
                        generateAlerts(parsedData);

                        setLoading(false);
                        setCardLoading({ metrics: false, shawarma: false, sales: false, inventory: false });
                    } catch (parseError) {
                        console.error('Error parsing dashboard data:', parseError);
                        setLoading(false);
                        setCardLoading({ metrics: false, shawarma: false, sales: false, inventory: false });
                    }
                })
                .withFailureHandler(error => {
                    console.error('Error loading dashboard:', error);
                    setLoading(false);
                    setCardLoading({ metrics: false, shawarma: false, sales: false, inventory: false });
                })
                .generateDashboardReport(dateParam, {
                    includeTrends: true,
                    includeComparisons: selectedPeriod !== 'custom',
                    includePettyCashAnalysis: true,
                    includeInventoryAnalysis: true,
                    compareToYesterday: selectedPeriod === 'today'
                });
        } catch (error) {
            console.error('Dashboard error:', error);
            setLoading(false);
            setCardLoading({ metrics: false, shawarma: false, sales: false, inventory: false });
        }
    };

    const processEnhancedAnalytics = (analytics) => {
        const processed = {
            alerts: [],
            recommendations: [],
            insights: []
        };

        if (analytics.pettyCash) {
            processed.petty_cash_summary = {
                total: analytics.pettyCash.total_amount,
                categories: Object.keys(analytics.pettyCash.categories).length,
                top_category: analytics.pettyCash.top_category,
                average: analytics.pettyCash.average_amount
            };

            analytics.pettyCash.recommendations.forEach(rec => {
                processed.recommendations.push({
                    ...rec,
                    source: 'petty_cash'
                });
            });
        }

        if (analytics.inventory) {
            processed.inventory_summary = {
                total_items: analytics.inventory.total_items_tracked,
                low_stock: analytics.inventory.low_stock_items.length,
                zero_stock: analytics.inventory.zero_stock_items.length,
                high_usage: analytics.inventory.high_usage_items.length,
                total_value: analytics.inventory.inventory_value
            };

            analytics.inventory.recommendations.forEach(rec => {
                processed.alerts.push({
                    ...rec,
                    source: 'inventory',
                    type: rec.priority === 'critical' ? 'danger' : rec.priority === 'high' ? 'warning' : 'info'
                });
            });
        }

        if (analytics.sales) {
            processed.sales_summary = {
                quality_score: analytics.sales.performance_metrics.revenue_quality_score,
                payment_diversity: analytics.sales.performance_metrics.payment_method_diversity,
                variance: analytics.sales.payment_breakdown.variance_from_total,
                shawarma_percentage: analytics.sales.performance_metrics.shawarma_percentage
            };

            analytics.sales.recommendations.forEach(rec => {
                processed.recommendations.push({
                    ...rec,
                    source: 'sales'
                });
            });
        }

        return processed;
    };

    const generateAlerts = (data) => {
        const newAlerts = [];

        if (data.shawarma) {
            const lossRange = getAcceptableLossRange();
            const wasteRange = getAcceptableTotalWasteRange(data.shawarma.starting_weight_kg || 0);
            const remainingRange = getAcceptableRemainingRange(data.shawarma.starting_weight_kg || 0);

            if (data.shawarma.loss_percentage > lossRange.max) {
                newAlerts.push({
                    type: 'danger',
                    icon: '⚠️',
                    title: 'High Cooking Loss',
                    message: `Loss is ${data.shawarma.loss_percentage.toFixed(1)}% (max ${lossRange.max}%)`,
                    action: 'Review cooking process'
                });
            } else if (data.shawarma.loss_percentage > 25) {
                newAlerts.push({
                    type: 'warning',
                    icon: '⚠️',
                    title: 'Cooking Loss Above Optimal',
                    message: `Loss is ${data.shawarma.loss_percentage.toFixed(1)}%`,
                    action: 'Check stack setup'
                });
            }

            if (data.shawarma.waste_percentage > wasteRange.max) {
                newAlerts.push({
                    type: 'danger',
                    icon: '⚠️',
                    title: 'High Shawarma Waste',
                    message: `Waste is ${data.shawarma.waste_percentage.toFixed(1)}% (max ${wasteRange.max.toFixed(1)}%)`,
                    action: 'Review cutting techniques and order timing'
                });
            }

            if (data.shawarma.remaining_weight_kg > remainingRange.max) {
                newAlerts.push({
                    type: 'danger',
                    icon: '⚠️',
                    title: 'High Remaining Weight',
                    message: `Remaining ${(data.shawarma.remaining_weight_kg * 1000).toFixed(0)}g (max ${(remainingRange.max * 1000).toFixed(0)}g)`,
                    action: 'Adjust cutting or order timing'
                });
            } else if (data.shawarma.remaining_weight_kg > remainingRange.optimal) {
                newAlerts.push({
                    type: 'warning',
                    icon: '⚠️',
                    title: 'Remaining Weight Above Optimal',
                    message: `Remaining ${(data.shawarma.remaining_weight_kg * 1000).toFixed(0)}g (optimal ${(remainingRange.optimal * 1000).toFixed(0)}g)`,
                    action: 'Check portion sizes'
                });
            }
        }

        if (data.shawarma && data.shawarma.staff_meals_weight_kg > 0.4) {
            newAlerts.push({
                type: 'warning',
                icon: '🍽️',
                title: 'Staff Meals Over Limit',
                message: `${data.shawarma.staff_meals_weight_kg}kg used (limit: 0.4kg)`,
                action: 'Monitor staff meal portions'
            });
        }

        if (data.sales && data.sales.food_cost_percentage > 25) {
            newAlerts.push({
                type: 'danger',
                icon: '💰',
                title: 'High Food Cost %',
                message: `Food cost is ${data.sales.food_cost_percentage.toFixed(1)}% (target: <25%)`,
                action: 'Review portion sizes and waste'
            });
        }

        if (data.shawarma && data.shawarma.profit_per_kg < 5) {
            newAlerts.push({
                type: 'warning',
                icon: '📉',
                title: 'Low Shawarma Profitability',
                message: `Profit per kg: ${data.shawarma.profit_per_kg.toFixed(2)} QAR`,
                action: 'Review pricing and costs'
            });
        }

        if (data.enhanced_analytics && data.enhanced_analytics.pettyCash) {
            const pettyCash = data.enhanced_analytics.pettyCash;
            if (pettyCash.total_amount > 200) {
                newAlerts.push({
                    type: 'warning',
                    icon: '💳',
                    title: 'High Petty Cash Spending',
                    message: `${pettyCash.total_amount.toFixed(2)} QAR spent today`,
                    action: 'Review expense necessity and approval process'
                });
            }
            if (pettyCash.categories['Fuel'] && pettyCash.categories['Fuel'].amount > 100) {
                newAlerts.push({
                    type: 'info',
                    icon: '⛽',
                    title: 'High Fuel Expenses',
                    message: `${pettyCash.categories['Fuel'].amount.toFixed(2)} QAR on fuel`,
                    action: 'Consider delivery route optimization'
                });
            }
            if (pettyCash.entry_count > 8) {
                newAlerts.push({
                    type: 'info',
                    icon: '📝',
                    title: 'Many Petty Cash Entries',
                    message: `${pettyCash.entry_count} entries today`,
                    action: 'Review if some expenses could be planned purchases'
                });
            }
        }

        if (data.processed_analytics && data.processed_analytics.inventory_summary) {
            const inventory = data.processed_analytics.inventory_summary;
            if (inventory.zero_stock > 0) {
                newAlerts.push({
                    type: 'danger',
                    icon: '📦',
                    title: 'Items Out of Stock',
                    message: `${inventory.zero_stock} items completely out of stock`,
                    action: 'Immediate restocking required'
                });
            }
            if (inventory.low_stock > 5) {
                newAlerts.push({
                    type: 'warning',
                    icon: '📉',
                    title: 'Multiple Low Stock Items',
                    message: `${inventory.low_stock} items below minimum levels`,
                    action: 'Schedule restocking for low inventory items'
                });
            }
            if (inventory.high_usage > 3) {
                newAlerts.push({
                    type: 'info',
                    icon: '📈',
                    title: 'High Usage Detected',
                    message: `${inventory.high_usage} items with unusually high usage`,
                    action: 'Verify usage accuracy and adjust forecasting'
                });
            }
        }

        if (data.enhanced_analytics && data.enhanced_analytics.sales) {
            const sales = data.enhanced_analytics.sales;
            if (sales.performance_metrics.revenue_quality_score < 60) {
                newAlerts.push({
                    type: 'warning',
                    icon: '📊',
                    title: 'Low Revenue Quality Score',
                    message: `Quality score: ${sales.performance_metrics.revenue_quality_score.toFixed(0)}/100`,
                    action: 'Review payment reconciliation and cost controls'
                });
            }
            if (sales.payment_breakdown.variance_from_total > 20) {
                newAlerts.push({
                    type: 'danger',
                    icon: '💰',
                    title: 'Payment Reconciliation Issue',
                    message: `${sales.payment_breakdown.variance_from_total.toFixed(2)} QAR discrepancy`,
                    action: 'Verify payment method totals against actual revenue'
                });
            }
            if (sales.performance_metrics.payment_method_diversity < 30) {
                newAlerts.push({
                    type: 'info',
                    icon: '💳',
                    title: 'Low Payment Method Diversity',
                    message: `Only ${sales.performance_metrics.payment_method_diversity.toFixed(0)}% payment diversity`,
                    action: 'Encourage diverse payment methods for better insights'
                });
            }
        }

        if (data.data_sources) {
            if (data.data_sources.primary_source === 'old_tables') {
                newAlerts.push({
                    type: 'info',
                    icon: '🔄',
                    title: 'Using Legacy Data',
                    message: 'Dashboard showing data from old system',
                    action: 'Consider migrating this date to new system'
                });
            }
            if (data.data_sources.data_quality && data.data_sources.data_quality.completeness < 80) {
                newAlerts.push({
                    type: 'warning',
                    icon: '⚠️',
                    title: 'Incomplete Data',
                    message: `Only ${data.data_sources.data_quality.completeness}% data completeness`,
                    action: 'Review and complete missing data entries'
                });
            }
        }

        setAlerts(newAlerts);
    };

    const getAlertColor = (type) => {
        switch (type) {
            case 'danger': return 'border-red-500 bg-red-50 text-red-800';
            case 'warning': return 'border-yellow-500 bg-yellow-50 text-yellow-800';
            case 'success': return 'border-green-500 bg-green-50 text-green-800';
            default: return 'border-blue-500 bg-blue-50 text-blue-800';
        }
    };

    const LoadingCard = ({ children, isLoading }) => {
        if (isLoading) {
            return (
                <div className="bg-white rounded-lg shadow p-6 animate-pulse">
                    <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                    <div className="h-8 bg-gray-200 rounded w-1/2 mb-2"></div>
                    <div className="h-3 bg-gray-200 rounded w-2/3"></div>
                </div>
            );
        }
        return children;
    };

    const SectionLoadingPlaceholder = ({ isLoading, children }) => {
        if (isLoading) {
            return (
                <div className="bg-white rounded-lg shadow p-6 animate-pulse">
                    <div className="h-6 bg-gray-200 rounded w-1/3 mb-4"></div>
                    <div className="space-y-3">
                        <div className="h-4 bg-gray-200 rounded"></div>
                        <div className="h-4 bg-gray-200 rounded w-5/6"></div>
                        <div className="h-4 bg-gray-200 rounded w-4/6"></div>
                    </div>
                </div>
            );
        }
        return children;
    };

 

    return (
        <div className="space-y-6">
            {/* Header */}
            <div className="bg-white rounded-lg shadow p-6">
                <div className="flex justify-between items-center">
                    <div>
                        <h1 className="text-2xl font-bold text-gray-800">Management Dashboard</h1>
                        <p className="text-gray-600">Real-time restaurant performance analytics</p>
                    </div>
                    <div className="flex items-center gap-4">
                        {/* Period Selector */}
                        <select
                            value={selectedPeriod}
                            onChange={e => {
                                setSelectedPeriod(e.target.value);
                                if (e.target.value !== 'custom') {
                                    setCustomDate('');
                                }
                            }}
                            className="px-3 py-2 border rounded focus:ring-2 focus:ring-olive-500"
                        >
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="custom">Custom Date</option>
                        </select>
                        
                        {/* Custom Date Input */}
                        {selectedPeriod === 'custom' && (
                            <input
                                type="date"
                                value={customDate}
                                onChange={e => setCustomDate(e.target.value)}
                                className="px-3 py-2 border rounded focus:ring-2 focus:ring-olive-500"
                            />
                        )}
                        
                        <button
                            onClick={loadDashboardData}
                            disabled={cardLoading.metrics || cardLoading.shawarma || cardLoading.sales || cardLoading.inventory}
                            className="bg-olive-600 text-white px-4 py-2 rounded hover:bg-olive-700 disabled:opacity-50 flex items-center gap-2"
                        >
                            {(cardLoading.metrics || cardLoading.shawarma || cardLoading.sales || cardLoading.inventory) && (
                                <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                            )}
                            Refresh
                        </button>
                    </div>
                </div>
            </div>

            {/* Alerts Section */}
            {alerts.length > 0 && (
                <div className="space-y-3">
                    <h2 className="text-lg font-semibold text-gray-800">🚨 Active Alerts</h2>
                    {alerts.map((alert, index) => (
                        <div key={index} className={`border-l-4 p-4 rounded-lg ${getAlertColor(alert.type)}`}>
                            <div className="flex items-start gap-3">
                                <span className="text-xl">{alert.icon}</span>
                                <div className="flex-1">
                                    <h3 className="font-semibold">{alert.title}</h3>
                                    <p className="text-sm mt-1">{alert.message}</p>
                                    <p className="text-xs mt-2 font-medium">Action: {alert.action}</p>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            )}

            {/* Key Metrics with individual loading */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {/* Shawarma Profitability */}
                <LoadingCard isLoading={cardLoading.metrics}>
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">Shawarma Profit/kg</p>
                                <p className="text-2xl font-bold text-green-600">
                                    {dashboardData && dashboardData.shawarma && dashboardData.shawarma.profit_per_kg ? 
                                        `${dashboardData.shawarma.profit_per_kg.toFixed(2)} QAR` : 'N/A'}
                                </p>
                            </div>
                            <div className="text-3xl">🥙</div>
                        </div>
                        <div className="mt-4 text-sm text-gray-500">
                            Revenue/kg: {dashboardData && dashboardData.shawarma && dashboardData.shawarma.revenue_per_kg ? 
                                dashboardData.shawarma.revenue_per_kg.toFixed(2) : 'N/A'} QAR
                        </div>
                    </div>
                </LoadingCard>

                {/* Food Cost Percentage */}
                <LoadingCard isLoading={cardLoading.metrics}>
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">Food Cost %</p>
                                <p className={`text-2xl font-bold ${
                                    ((dashboardData && dashboardData.sales && dashboardData.sales.food_cost_percentage) || 0) > 25 ? 'text-red-600' : 'text-green-600'
                                }`}>
                                    {dashboardData && dashboardData.sales && dashboardData.sales.food_cost_percentage ? 
                                        `${dashboardData.sales.food_cost_percentage.toFixed(1)}%` : 'N/A'}
                                </p>
                            </div>
                            <div className="text-3xl">💰</div>
                        </div>
                        <div className="mt-4 text-sm text-gray-500">
                            Target: &lt; 25%
                        </div>
                    </div>
                </LoadingCard>

                {/* Shawarma Waste */}
                <LoadingCard isLoading={cardLoading.metrics}>
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">Total Waste</p>
                                <p className={`text-2xl font-bold ${
                                    !(dashboardData && dashboardData.shawarma && dashboardData.shawarma.waste_percentage) ? 'text-gray-400' :
                                    dashboardData.shawarma.waste_percentage > (dashboardData.shawarma.total_waste_range ? dashboardData.shawarma.total_waste_range.max : 28) ? 'text-red-600' :
                                    'text-green-600'
                                }`}>
                                    {dashboardData && dashboardData.shawarma && dashboardData.shawarma.waste_percentage ?
                                        `${dashboardData.shawarma.waste_percentage.toFixed(1)}%` : 'N/A'}
                                </p>
                                {dashboardData && dashboardData.shawarma && dashboardData.shawarma.loss_weight_kg !== undefined && (
                                    <p className="text-xs text-gray-600 mt-1">
                                        Loss: {dashboardData.shawarma.loss_weight_kg.toFixed(3)} kg ({dashboardData.shawarma.loss_percentage.toFixed(1)}%)
                                    </p>
                                )}
                            </div>
                            <div className="text-3xl">🗑️</div>
                        </div>
                        <div className="mt-4 text-sm text-gray-500">
                            {dashboardData && dashboardData.shawarma && dashboardData.shawarma.total_waste_range ?
                                `Target: ${dashboardData.shawarma.total_waste_range.min.toFixed(1)}-${dashboardData.shawarma.total_waste_range.max.toFixed(1)}%` :
                                'Target: 12-28%'}
                        </div>
                    </div>
                </LoadingCard>

                {/* Daily Revenue */}
                <LoadingCard isLoading={cardLoading.metrics}>
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">Daily Revenue</p>
                                <p className="text-2xl font-bold text-blue-600">
                                    {dashboardData && dashboardData.sales && dashboardData.sales.total_revenue ? 
                                        `${dashboardData.sales.total_revenue.toFixed(2)} QAR` : 'N/A'}
                                </p>
                            </div>
                            <div className="text-3xl">📈</div>
                        </div>
                        <div className="mt-4 text-sm text-gray-500">
                            Orders: {dashboardData && dashboardData.sales && dashboardData.sales.total_orders ? 
                                dashboardData.sales.total_orders : 'N/A'}
                        </div>
                    </div>
                </LoadingCard>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="bg-white rounded-lg shadow-md p-6 border-l-4 border-indigo-500">
                    <div className="flex items-center">
                        <div className="flex-1">
                            <p className="text-sm font-medium text-gray-600">Revenue Quality</p>
                            <p className={`text-2xl font-bold ${dashboardData && dashboardData.processed_analytics && dashboardData.processed_analytics.sales_summary ? (dashboardData.processed_analytics.sales_summary.quality_score >= 80 ? 'text-green-600' : dashboardData.processed_analytics.sales_summary.quality_score >= 60 ? 'text-yellow-600' : 'text-red-600') : 'text-gray-400'}`}>
                                {dashboardData && dashboardData.processed_analytics && dashboardData.processed_analytics.sales_summary ? `${dashboardData.processed_analytics.sales_summary.quality_score.toFixed(0)}/100` : 'N/A'}
                            </p>
                            <p className="text-xs text-gray-500">Payment accuracy & mix</p>
                        </div>
                        <div className="text-3xl text-indigo-500">📊</div>
                    </div>
                </div>

                <div className="bg-white rounded-lg shadow-md p-6 border-l-4 border-orange-500">
                    <div className="flex items-center">
                        <div className="flex-1">
                            <p className="text-sm font-medium text-gray-600">Petty Cash Today</p>
                            <p className={`text-2xl font-bold ${dashboardData && dashboardData.processed_analytics && dashboardData.processed_analytics.petty_cash_summary ? (dashboardData.processed_analytics.petty_cash_summary.total > 150 ? 'text-red-600' : dashboardData.processed_analytics.petty_cash_summary.total > 75 ? 'text-yellow-600' : 'text-green-600') : 'text-gray-400'}`}>
                                {dashboardData && dashboardData.processed_analytics && dashboardData.processed_analytics.petty_cash_summary ? `${dashboardData.processed_analytics.petty_cash_summary.total.toFixed(2)} QAR` : 'N/A'}
                            </p>
                            <p className="text-xs text-gray-500">
                                {dashboardData && dashboardData.processed_analytics && dashboardData.processed_analytics.petty_cash_summary ? `${dashboardData.processed_analytics.petty_cash_summary.categories} categories` : 'No entries'}
                            </p>
                        </div>
                        <div className="text-3xl text-orange-500">💳</div>
                    </div>
                </div>

                <div className="bg-white rounded-lg shadow-md p-6 border-l-4 border-teal-500">
                    <div className="flex items-center">
                        <div className="flex-1">
                            <p className="text-sm font-medium text-gray-600">Inventory Health</p>
                            <p className={`text-2xl font-bold ${dashboardData && dashboardData.processed_analytics && dashboardData.processed_analytics.inventory_summary ? (dashboardData.processed_analytics.inventory_summary.zero_stock > 0 ? 'text-red-600' : dashboardData.processed_analytics.inventory_summary.low_stock > 3 ? 'text-yellow-600' : 'text-green-600') : 'text-gray-400'}`}>
                                {dashboardData && dashboardData.processed_analytics && dashboardData.processed_analytics.inventory_summary ? `${dashboardData.processed_analytics.inventory_summary.low_stock + dashboardData.processed_analytics.inventory_summary.zero_stock}` : 'N/A'}
                            </p>
                            <p className="text-xs text-gray-500">Items needing attention</p>
                        </div>
                        <div className="text-3xl text-teal-500">📦</div>
                    </div>
                </div>
            </div>

            {/* Detailed Analytics with individual loading */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Shawarma Analytics */}
                <SectionLoadingPlaceholder isLoading={cardLoading.shawarma}>
                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-semibold text-gray-800 mb-4">🥙 Shawarma Stack Analysis</h3>
                        {dashboardData && dashboardData.shawarma ? (
                            <div className="space-y-4">
                                <div className="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span className="text-gray-600">Starting Weight:</span>
                                        <p className="font-medium">{dashboardData.shawarma.starting_weight_kg ? 
                                            dashboardData.shawarma.starting_weight_kg.toFixed(3) : 'N/A'} kg</p>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Remaining Weight:</span>
                                        <p className={`font-medium ${
                                            dashboardData.shawarma.remaining_range && dashboardData.shawarma.remaining_weight_kg > dashboardData.shawarma.remaining_range.max ? 'text-red-600' :
                                            dashboardData.shawarma.remaining_range && dashboardData.shawarma.remaining_weight_kg > dashboardData.shawarma.remaining_range.optimal ? 'text-yellow-600' : ''
                                        }`}>
                                            {dashboardData.shawarma.remaining_weight_kg ?
                                                dashboardData.shawarma.remaining_weight_kg.toFixed(3) : 'N/A'} kg
                                        </p>
                                        {dashboardData.shawarma.remaining_range && (
                                            <p className="text-xs text-gray-600">Max {(dashboardData.shawarma.remaining_range.max * 1000).toFixed(0)}g</p>
                                        )}
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Orders Weight:</span>
                                        <p className="font-medium">{dashboardData.shawarma.orders_weight_kg ? 
                                            dashboardData.shawarma.orders_weight_kg.toFixed(3) : 'N/A'} kg</p>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Shaving Weight:</span>
                                        <p className="font-medium">{dashboardData.shawarma.shaving_weight_kg ? 
                                            dashboardData.shawarma.shaving_weight_kg.toFixed(3) : 'N/A'} kg</p>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Staff Meals:</span>
                                        <p className={`font-medium ${(dashboardData.shawarma.staff_meals_weight_kg || 0) > 0.4 ? 'text-red-600' : 'text-green-600'}`}>
                                            {dashboardData.shawarma.staff_meals_weight_kg ?
                                                dashboardData.shawarma.staff_meals_weight_kg.toFixed(3) : '0.000'} kg
                                        </p>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Loss Weight:</span>
                                        <p className="font-medium">{dashboardData.shawarma.loss_weight_kg !== undefined ?
                                            dashboardData.shawarma.loss_weight_kg.toFixed(3) : 'N/A'} kg ({dashboardData.shawarma.loss_percentage !== undefined ? dashboardData.shawarma.loss_percentage.toFixed(1) : 'N/A'}%)</p>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Waste Weight:</span>
                                        <p className="font-medium">{dashboardData.shawarma.waste_weight_kg ?
                                            dashboardData.shawarma.waste_weight_kg.toFixed(3) : 'N/A'} kg</p>
                                    </div>
                                </div>
                                
                                <div className="border-t pt-4">
                                    <h4 className="font-medium text-gray-700 mb-2">Profitability Metrics</h4>
                                    <div className="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span className="text-gray-600">Revenue per kg:</span>
                                            <p className="font-medium text-green-600">{dashboardData.shawarma.revenue_per_kg ? 
                                                dashboardData.shawarma.revenue_per_kg.toFixed(2) : 'N/A'} QAR</p>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">Cost per kg:</span>
                                            <p className="font-medium">{dashboardData.shawarma.starting_weight_kg && dashboardData.shawarma.stack_cost_qar ? 
                                                (dashboardData.shawarma.stack_cost_qar / dashboardData.shawarma.starting_weight_kg).toFixed(2) : 'N/A'} QAR</p>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">Profit per kg:</span>
                                            <p className="font-medium text-green-600">{dashboardData.shawarma.profit_per_kg ? 
                                                dashboardData.shawarma.profit_per_kg.toFixed(2) : 'N/A'} QAR</p>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">Total Stack Cost:</span>
                                            <p className="font-medium">{dashboardData.shawarma.stack_cost_qar ? 
                                                dashboardData.shawarma.stack_cost_qar.toFixed(2) : 'N/A'} QAR</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <p className="text-gray-500">No shawarma data available for selected period</p>
                        )}
                    </div>
                </SectionLoadingPlaceholder>

            </div>
                {/* Enhanced Sales Performance */}
                <div className="bg-white rounded-lg shadow-md p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">📊 Enhanced Sales Performance</h3>
                    {dashboardData && dashboardData.sales ? (
                        <div className="space-y-6">
                            <div>
                                <h4 className="font-medium text-gray-700 mb-3">Revenue Breakdown</h4>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div className="bg-blue-50 p-3 rounded">
                                        <span className="text-gray-600">Total Revenue:</span>
                                        <p className="font-medium text-blue-600 text-lg">{(dashboardData.sales.total_revenue || 0).toFixed(2)} QAR</p>
                                    </div>
                                    <div className="bg-green-50 p-3 rounded">
                                        <span className="text-gray-600">Shawarma:</span>
                                        <p className="font-medium text-green-600 text-lg">{(dashboardData.sales.shawarma_revenue || 0).toFixed(2)} QAR</p>
                                        <p className="text-xs text-gray-500">{((dashboardData.sales.shawarma_revenue || 0) / (dashboardData.sales.total_revenue || 1) * 100).toFixed(1)}%</p>
                                    </div>
                                    <div className="bg-purple-50 p-3 rounded">
                                        <span className="text-gray-600">Other Food:</span>
                                        <p className="font-medium text-purple-600 text-lg">{(dashboardData.sales.other_food_revenue || 0).toFixed(2)} QAR</p>
                                        <p className="text-xs text-gray-500">{((dashboardData.sales.other_food_revenue || 0) / (dashboardData.sales.total_revenue || 1) * 100).toFixed(1)}%</p>
                                    </div>
                                    <div className="bg-orange-50 p-3 rounded">
                                        <span className="text-gray-600">Petty Cash:</span>
                                        <p className="font-medium text-orange-600 text-lg">{(dashboardData.sales.petty_cash_total || 0).toFixed(2)} QAR</p>
                                        <p className="text-xs text-gray-500">{((dashboardData.sales.petty_cash_total || 0) / (dashboardData.sales.total_revenue || 1) * 100).toFixed(1)}%</p>
                                    </div>
                                </div>
                            </div>

                            {dashboardData.enhanced_analytics && dashboardData.enhanced_analytics.sales && (
                                <div>
                                    <h4 className="font-medium text-gray-700 mb-3">Payment Methods</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                        {Object.entries(dashboardData.enhanced_analytics.sales.payment_breakdown).map(([method, data]) => {
                                            if (method === 'total_breakdown' || method === 'variance_from_total') return null;
                                            const methodNames = { cash: 'Cash', card: 'Card', delivery_aggregator_1: 'Delivery 1', delivery_aggregator_2: 'Delivery 2' };
                                            return (
                                                <div key={method} className="border rounded p-2">
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-gray-600 text-xs">{methodNames[method] || method}</span>
                                                        <span className="font-medium">{data.amount.toFixed(2)}</span>
                                                    </div>
                                                    <div className="mt-1">
                                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                                            <div className="bg-blue-600 h-2 rounded-full" style={{ width: `${Math.min(100, data.percentage)}%` }}></div>
                                                        </div>
                                                        <span className="text-xs text-gray-500">{data.percentage.toFixed(1)}%</span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    {dashboardData.enhanced_analytics.sales.payment_breakdown.variance_from_total > 0 && (
                                        <div className={`mt-3 p-2 rounded text-sm ${
                                            dashboardData.enhanced_analytics.sales.payment_breakdown.variance_from_total > 10 ? 'bg-red-50 text-red-800' :
                                            dashboardData.enhanced_analytics.sales.payment_breakdown.variance_from_total > 2 ? 'bg-yellow-50 text-yellow-800' :
                                            'bg-green-50 text-green-800'
                                        }`}>
                                            <span className="font-medium">Payment Validation: </span>
                                            {dashboardData.enhanced_analytics.sales.payment_breakdown.variance_from_total > 10 ?
                                                `Large discrepancy: ${dashboardData.enhanced_analytics.sales.payment_breakdown.variance_from_total.toFixed(2)} QAR` :
                                                dashboardData.enhanced_analytics.sales.payment_breakdown.variance_from_total > 2 ?
                                                `Small discrepancy: ${dashboardData.enhanced_analytics.sales.payment_breakdown.variance_from_total.toFixed(2)} QAR` :
                                                'Payments match total revenue'
                                            }
                                        </div>
                                    )}
                                </div>
                            )}

                            {dashboardData.enhanced_analytics && dashboardData.enhanced_analytics.sales && (
                                <div>
                                    <h4 className="font-medium text-gray-700 mb-3">Performance Metrics</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                        <div className="border rounded p-3">
                                            <span className="text-gray-600">Revenue Quality Score:</span>
                                            <p className={`font-medium text-lg ${
                                                dashboardData.enhanced_analytics.sales.performance_metrics.revenue_quality_score >= 80 ? 'text-green-600' :
                                                dashboardData.enhanced_analytics.sales.performance_metrics.revenue_quality_score >= 60 ? 'text-yellow-600' : 'text-red-600'
                                            }`}>{dashboardData.enhanced_analytics.sales.performance_metrics.revenue_quality_score.toFixed(0)}/100</p>
                                        </div>
                                        <div className="border rounded p-3">
                                            <span className="text-gray-600">Payment Diversity:</span>
                                            <p className={`font-medium text-lg ${
                                                dashboardData.enhanced_analytics.sales.performance_metrics.payment_method_diversity >= 70 ? 'text-green-600' :
                                                dashboardData.enhanced_analytics.sales.performance_metrics.payment_method_diversity >= 40 ? 'text-yellow-600' : 'text-red-600'
                                            }`}>{dashboardData.enhanced_analytics.sales.performance_metrics.payment_method_diversity.toFixed(0)}%</p>
                                        </div>
                                        <div className="border rounded p-3">
                                            <span className="text-gray-600">Food Cost %:</span>
                                            <p className={`font-medium text-lg ${
                                                dashboardData.enhanced_analytics.sales.performance_metrics.food_cost_percentage <= 25 ? 'text-green-600' :
                                                dashboardData.enhanced_analytics.sales.performance_metrics.food_cost_percentage <= 30 ? 'text-yellow-600' : 'text-red-600'
                                            }`}>{dashboardData.enhanced_analytics.sales.performance_metrics.food_cost_percentage.toFixed(1)}%</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    ) : (
                        <p className="text-gray-500">No sales data available for selected period</p>
                    )}
                </div>

            {/* Inventory Overview */}
            <SectionLoadingPlaceholder isLoading={cardLoading.inventory}>
                <div className="bg-white rounded-lg shadow p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">📦 Inventory Overview</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {/* Raw Proteins */}
                        <div>
                            <h4 className="font-medium text-gray-700 mb-3">Raw Proteins</h4>
                            <div className="space-y-2 text-sm">
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Chicken Shawarma:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.chicken_shawarma_remaining ? 
                                        dashboardData.inventory.chicken_shawarma_remaining : 'N/A'} kg</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Chicken Breast:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.frozen_chicken_breast_remaining ?
                                        dashboardData.inventory.frozen_chicken_breast_remaining : 'N/A'} kg</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Steak:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.steak_remaining ? 
                                        dashboardData.inventory.steak_remaining : 'N/A'} kg</span>
                                </div>
                            </div>
                        </div>

                        {/* Bread */}
                        <div>
                            <h4 className="font-medium text-gray-700 mb-3">Bread</h4>
                            <div className="space-y-2 text-sm">
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Saj Bread:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.saj_bread_remaining ? 
                                        dashboardData.inventory.saj_bread_remaining : 'N/A'} pcs</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Bread Roll:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.bread_roll_remaining ? 
                                        dashboardData.inventory.bread_roll_remaining : 'N/A'} pcs</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Pita Bread:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.pita_bread_remaining ? 
                                        dashboardData.inventory.pita_bread_remaining : 'N/A'} pcs</span>
                                </div>
                            </div>
                        </div>

                        {/* High-Cost Items */}
                        <div>
                            <h4 className="font-medium text-gray-700 mb-3">High-Cost Items</h4>
                            <div className="space-y-2 text-sm">
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Cream:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.cream_remaining ? 
                                        dashboardData.inventory.cream_remaining : 'N/A'} kg</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Mayo:</span>
                                    <span className="font-medium">{dashboardData && dashboardData.inventory && dashboardData.inventory.mayo_remaining ? 
                                        dashboardData.inventory.mayo_remaining : 'N/A'} kg</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </SectionLoadingPlaceholder>

            {/* Product Sales Breakdown */}
            {dashboardData && dashboardData.productSales && dashboardData.productSales.length > 0 && (
                <div className="bg-white rounded-lg shadow p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">📋 Product Sales Breakdown</h3>
                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty Sold</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Revenue</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Food Cost</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Profit Margin</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {dashboardData.productSales.map((product, index) => (
                                    <tr key={index}>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                            {product.product_name}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {product.quantity_sold}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {product.total_revenue ? product.total_revenue.toFixed(2) : '0.00'} QAR
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {product.total_cost ? product.total_cost.toFixed(2) : '0.00'} QAR
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                                (product.profit_margin || 0) > 75 ? 'bg-green-100 text-green-800' :
                                                (product.profit_margin || 0) > 60 ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-red-100 text-red-800'
                                            }`}>
                                                {product.profit_margin ? product.profit_margin.toFixed(1) : '0.0'}%
                                            </span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            )}

            {/* Recommended Actions */}
            <div className="bg-white rounded-lg shadow p-6">
                <h3 className="text-lg font-semibold text-gray-800 mb-4">✅ Recommended Actions</h3>
                <div className="space-y-3">
                    {alerts.length === 0 ? (
                        <div className="flex items-center gap-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                            <span className="text-green-600 text-xl">✅</span>
                            <div>
                                <p className="font-medium text-green-800">All Systems Normal</p>
                                <p className="text-sm text-green-600">No immediate actions required. Keep monitoring performance.</p>
                            </div>
                        </div>
                    ) : (
                        <div>
                            {alerts.filter(alert => alert.type === 'danger').map((alert, index) => (
                                <div key={`danger-${index}`} className="flex items-center gap-3 p-3 bg-red-50 border border-red-200 rounded-lg mb-3">
                                    <span className="text-red-600 text-xl">🚨</span>
                                    <div>
                                        <p className="font-medium text-red-800">High Priority: {alert.title}</p>
                                        <p className="text-sm text-red-600">{alert.action}</p>
                                    </div>
                                </div>
                            ))}
                            {alerts.filter(alert => alert.type === 'warning').map((alert, index) => (
                                <div key={`warning-${index}`} className="flex items-center gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <span className="text-yellow-600 text-xl">⚠️</span>
                                    <div>
                                        <p className="font-medium text-yellow-800">Medium Priority: {alert.title}</p>
                                        <p className="text-sm text-yellow-600">{alert.action}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </div>

            {/* Data Status Section - Collapsible */}
            <div className="bg-white rounded-lg shadow">
                <button
                    onClick={() => setShowDataStatus(!showDataStatus)}
                    className="w-full p-6 text-left flex justify-between items-center hover:bg-gray-50"
                >
                    <div>
                        <h3 className="text-lg font-semibold text-gray-800">📊 Data Status & Information</h3>
                        <p className="text-sm text-gray-600">View data availability and system information</p>
                    </div>
                    <div className={`transform transition-transform ${showDataStatus ? 'rotate-180' : ''}`}>
                        <svg className="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </button>
                
                {showDataStatus && (
                    <div className="px-6 pb-6 border-t">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            {/* Data Availability */}
                            <div>
                                <h4 className="font-medium text-gray-700 mb-3">Data Availability</h4>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Shawarma Data:</span>
                                        <span className={`font-medium ${dashboardData && dashboardData.data_found && dashboardData.data_found.shawarma ? 'text-green-600' : 'text-red-600'}`}>
                                            {dashboardData && dashboardData.data_found && dashboardData.data_found.shawarma ? 'Available' : 'Missing'}
                                        </span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Sales Data:</span>
                                        <span className={`font-medium ${dashboardData && dashboardData.data_found && dashboardData.data_found.sales ? 'text-green-600' : 'text-red-600'}`}>
                                            {dashboardData && dashboardData.data_found && dashboardData.data_found.sales ? 'Available' : 'Missing'}
                                        </span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Inventory Data:</span>
                                        <span className={`font-medium ${dashboardData && dashboardData.data_found && dashboardData.data_found.rawProteins ? 'text-green-600' : 'text-red-600'}`}>
                                            {dashboardData && dashboardData.data_found && dashboardData.data_found.rawProteins ? 'Available' : 'Missing'}
                                        </span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Bread Data:</span>
                                        <span className={`font-medium ${dashboardData && dashboardData.data_found && dashboardData.data_found.bread ? 'text-green-600' : 'text-red-600'}`}>
                                            {dashboardData && dashboardData.data_found && dashboardData.data_found.bread ? 'Available' : 'Missing'}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            {/* Period Information */}
                            <div>
                                <h4 className="font-medium text-gray-700 mb-3">Period Information</h4>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Selected Period:</span>
                                        <span className="font-medium">{selectedPeriod === 'custom' ? 'Custom Date' : selectedPeriod.charAt(0).toUpperCase() + selectedPeriod.slice(1)}</span>
                                    </div>
                                    {customDate && (
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">Custom Date:</span>
                                            <span className="font-medium">{customDate}</span>
                                        </div>
                                    )}
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Requested Date:</span>
                                        <span className="font-medium">{dashboardData && dashboardData.requested_date ? dashboardData.requested_date : 'N/A'}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Data Date:</span>
                                        <span className="font-medium">{dashboardData && dashboardData.date ? dashboardData.date : 'N/A'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Debug Data Toggle */}
                        <div className="mt-6 border-t pt-4">
                            <button
                                onClick={() => setShowDebugData(!showDebugData)}
                                className="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800"
                            >
                                <span className={`transform transition-transform ${showDebugData ? 'rotate-90' : ''}`}>
                                    ▶
                                </span>
                                View Debug Data (Raw JSON)
                            </button>
                            
                            {showDebugData && (
                                <div className="mt-3">
                                    <div className="bg-gray-100 p-4 rounded-lg overflow-auto max-h-96">
                                        <pre className="text-xs text-gray-800">
                                            {JSON.stringify(dashboardData, null, 2)}
                                        </pre>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
}

window.ManagementDashboard = ManagementDashboard;
</script>